<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.7" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenPFC: an open source framework for high performance 3D phase field crystal simulations</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
  </script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <style>
    .github-corner svg {
      fill: var(--primary-light-color);
      color: var(--page-background-color);
      width: 72px;
      height: 72px;
    }
    .github-corner:hover .octo-arm {
      animation: octocat-wave 560ms ease-in-out
    }
    @keyframes octocat-wave {
      0%,
      100% {
        transform: rotate(0)
      }
      20%,
      60% {
        transform: rotate(-25deg)
      }
      40%,
      80% {
        transform: rotate(10deg)
      }
    }
    @media (max-width:500px) {
      .github-corner:hover .octo-arm {
        animation: none
      }
      .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }
    }
    @media screen and (max-width: 767px) {
      .github-corner svg {
        width: 50px;
        height: 50px;
      }
      #projectnumber {
        margin-right: 22px;
      }
    }
  </style>
</head>
<body>
  <!-- https://tholman.com/github-corners/ -->
  <a href="https://github.com/VTT-ProperTune/OpenPFC" class="github-corner" title="View source on GitHub"
    target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40"
      style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path
        d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
        fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path
        d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
        fill="currentColor" class="octo-body"></path>
    </svg></a>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="logo.png" /></td>
              <td id="projectalign">
                <div id="projectname">OpenPFC
                  <span id="projectnumber">&#160;0.1.0</span>
                </div>
                <div id="projectbrief">Phase Field Crystal simulation framework</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('03_parallel_fft_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">03_parallel_fft.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>When the World and Decomposition are defined, the next step is to specify the FFT, which serves as the true workhorse of OpenPFC. It is responsible for performing the parallel FFT computations. OpenPFC leverages the remarkable algorithm provided by the HeFFTe library, which is widely recognized and proven to be an efficient implementation. With these three fundamental components in place, one can already embark on building programs that involve distributed FFT transformations. The following example demonstrates the power of these components by showcasing a distributed FFT computation.</p>
<p>The provided example demonstrates the usage of the parallel Fast Fourier Transform (FFT) implementation in OpenPFC. Here's a description of what the example does:</p>
<p>The program begins by including the necessary headers and namespaces for the OpenPFC library and standard C++ functionality. It also defines a utility function <code>print_vec</code> to print the contents of a vector.</p>
<p>The next part of the code defines a naive Discrete Fourier Transform (DFT) implementation called <code>dft_forward</code>, which performs a forward DFT transformation using complex arithmetic.</p>
<p>The main function initializes the MPI process, retrieves the rank and number of processes, and sets up the necessary components for parallel computing using OpenPFC. It creates a <code>World</code> object with a size of 8 in the x-direction and 1 in the y- and z-directions. It then constructs a <code>Decomposition</code> object based on the created <code>World</code> and the MPI communicator. Finally, it creates an <code>FFT</code> object using the <code>Decomposition</code> and MPI communicator.</p>
<p>Two vectors, <code>in</code> and <code>out</code>, are created to store the input data and the results of the FFT computation, respectively. The input data is initialized with values based on the index. The <code>forward</code> method of the <code>FFT</code> object is called to perform the parallel FFT transformation on the input data.</p>
<p>To validate the results, the program also applies the <code>dft_forward</code> function to the input data and stores the results in the <code>out2</code> vector.</p>
<p>The program then prints the input and output data of the parallel FFT implementation and the naive DFT implementation (only done by rank 0). It calculates and prints the norms of the output data from both implementations and computes the error by comparing the norms.</p>
<p>Finally, the MPI process is finalized, and the program terminates.</p>
<p>The example essentially compares the results of the parallel FFT implementation provided by OpenPFC with a naive DFT implementation to verify the correctness of the parallel FFT.</p>
<p>Expected output is: </p><pre class="fragment"> HeFFTe parallel FFT implementation

 Input data:
 [0.000, 0.785, 1.571, 2.356, 3.142, 3.927, 4.712, 5.498]
 Output data:
 [(21.991,0.000), (-3.142,7.584), (-3.142,3.142), (-3.142,1.301), (-3.142,0.000)]

 Naive DFT implementation

 Input data:
 [0.000, 0.785, 1.571, 2.356, 3.142, 3.927, 4.712, 5.498]
 Output data:
 [(21.991,0.000), (-3.142,7.584), (-3.142,3.142), (-3.142,1.301), (-3.142,-0.000)]

 Norms:

 0: 483.611, 483.611
 1: 67.394, 67.394
 2: 19.739, 19.739
 3: 11.563, 11.563
 4: 9.870, 9.870

 Error: -0.000000000000
</pre><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="decomposition_8hpp.html">openpfc/decomposition.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fft_8hpp.html">openpfc/fft.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="world_8hpp.html">openpfc/world.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacepfc.html">pfc</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print vector contents */</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a id="a0" name="a0"></a><a class="code hl_function" href="03__parallel__fft_8cpp.html#a52bf9a1923f8286de6dde59b22a9b78a">print_vec</a>(<span class="keyword">const</span> vector&lt;T&gt; &amp;v) {</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;e : v) {</div>
<div class="line">    std::cout &lt;&lt; e;</div>
<div class="line">    <span class="keywordflow">if</span> (&amp;e != &amp;v.back()) std::cout &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* A naive DFT implementation */</span></div>
<div class="line"><span class="keywordtype">void</span> <a id="a1" name="a1"></a><a class="code hl_function" href="03__parallel__fft_8cpp.html#ad1c65ef93890125f9c114719329925f6">dft_forward</a>(<span class="keyword">const</span> vector&lt;double&gt; x, vector&lt;complex&lt;double&gt;&gt; &amp;X) {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> pi = 4.0 * atan(1.0);</div>
<div class="line">  fill(X.begin(), X.end(), 0.0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0, N = x.size(); n &lt; N; n++) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; N / 2 + 1; k++) {</div>
<div class="line">      X[k] += x[n] * complex&lt;double&gt;(cos(2 * pi / N * k * n), -sin(2 * pi / N * k * n));</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a2" name="a2"></a><a class="code hl_function" href="01__hello__world_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  cout &lt;&lt; fixed;</div>
<div class="line">  cout.precision(3);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialize MPI process, get number of ranks and current rank number</span></div>
<div class="line">  MPI_Init(&amp;argc, &amp;argv);</div>
<div class="line">  MPI_Comm comm = MPI_COMM_WORLD;</div>
<div class="line">  <span class="keywordtype">int</span> rank, num_procs;</div>
<div class="line">  MPI_Comm_rank(comm, &amp;rank);</div>
<div class="line">  MPI_Comm_size(comm, &amp;num_procs);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Construct world, decomposition and fft</span></div>
<div class="line">  <a id="_a3" name="_a3"></a><a class="code hl_class" href="classpfc_1_1World.html">World</a> world({8, 1, 1});</div>
<div class="line">  <a id="_a4" name="_a4"></a><a class="code hl_class" href="classpfc_1_1Decomposition.html">Decomposition</a> decomposition(world, comm);</div>
<div class="line">  <a id="_a5" name="_a5"></a><a class="code hl_class" href="classpfc_1_1FFT.html">FFT</a> <a id="a6" name="a6"></a><a class="code hl_function" href="mpi__timers_8cpp.html#a3a49057ffba576f4b5efe09f8a175879">fft</a>(decomposition, comm);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create two vectors; in contains input data and results are stored to out</span></div>
<div class="line">  vector&lt;double&gt; in(<a class="code hl_function" href="mpi__timers_8cpp.html#a3a49057ffba576f4b5efe09f8a175879">fft</a>.size_inbox());</div>
<div class="line">  vector&lt;complex&lt;double&gt;&gt; out(<a class="code hl_function" href="mpi__timers_8cpp.html#a3a49057ffba576f4b5efe09f8a175879">fft</a>.size_outbox());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, N = in.size(); i &lt; N; i++) {</div>
<div class="line">    in[i] = i * atan(1.0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Perform FFT for input data using parallel FFT</span></div>
<div class="line">  <a class="code hl_function" href="mpi__timers_8cpp.html#a3a49057ffba576f4b5efe09f8a175879">fft</a>.forward(in, out);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Let&#39;s use our own implementation to check the results</span></div>
<div class="line">  vector&lt;complex&lt;double&gt;&gt; out2(<a class="code hl_function" href="mpi__timers_8cpp.html#a3a49057ffba576f4b5efe09f8a175879">fft</a>.size_outbox());</div>
<div class="line">  <a class="code hl_function" href="03__parallel__fft_8cpp.html#ad1c65ef93890125f9c114719329925f6">dft_forward</a>(in, out2);</div>
<div class="line"> </div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;HeFFTe parallel FFT implementation\n\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Input data:\n&quot;</span>;</div>
<div class="line">    <a class="code hl_function" href="03__parallel__fft_8cpp.html#a52bf9a1923f8286de6dde59b22a9b78a">print_vec</a>(in);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Output data:\n&quot;</span>;</div>
<div class="line">    <a class="code hl_function" href="03__parallel__fft_8cpp.html#a52bf9a1923f8286de6dde59b22a9b78a">print_vec</a>(out);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;\nNaive DFT implementation\n\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Input data:\n&quot;</span>;</div>
<div class="line">    <a class="code hl_function" href="03__parallel__fft_8cpp.html#a52bf9a1923f8286de6dde59b22a9b78a">print_vec</a>(in);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Output data:\n&quot;</span>;</div>
<div class="line">    <a class="code hl_function" href="03__parallel__fft_8cpp.html#a52bf9a1923f8286de6dde59b22a9b78a">print_vec</a>(out2);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> err = 0.0;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;\nNorms:\n\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, N = out.size(); i &lt; N; i++) {</div>
<div class="line">    cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; norm(out[i]) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; norm(out2[i]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    err += norm(out[i]);</div>
<div class="line">    err -= norm(out2[i]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  cout.precision(12);</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;\nError: &quot;</span> &lt;&lt; err &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  MPI_Finalize();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="a01__hello__world_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="01__hello__world_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> 01_hello_world.cpp:30</div></div>
<div class="ttc" id="a03__parallel__fft_8cpp_html_a52bf9a1923f8286de6dde59b22a9b78a"><div class="ttname"><a href="03__parallel__fft_8cpp.html#a52bf9a1923f8286de6dde59b22a9b78a">print_vec</a></div><div class="ttdeci">void print_vec(const vector&lt; T &gt; &amp;v)</div><div class="ttdef"><b>Definition</b> 03_parallel_fft.cpp:12</div></div>
<div class="ttc" id="a03__parallel__fft_8cpp_html_ad1c65ef93890125f9c114719329925f6"><div class="ttname"><a href="03__parallel__fft_8cpp.html#ad1c65ef93890125f9c114719329925f6">dft_forward</a></div><div class="ttdeci">void dft_forward(const vector&lt; double &gt; x, vector&lt; complex&lt; double &gt; &gt; &amp;X)</div><div class="ttdef"><b>Definition</b> 03_parallel_fft.cpp:22</div></div>
<div class="ttc" id="aclasspfc_1_1Decomposition_html"><div class="ttname"><a href="classpfc_1_1Decomposition.html">pfc::Decomposition</a></div><div class="ttdoc">Class representing the domain decomposition for parallel Fast Fourier Transform.</div><div class="ttdef"><b>Definition</b> decomposition.hpp:20</div></div>
<div class="ttc" id="aclasspfc_1_1FFT_html"><div class="ttname"><a href="classpfc_1_1FFT.html">pfc::FFT</a></div><div class="ttdoc">FFT class for performing forward and backward Fast Fourier Transformations.</div><div class="ttdef"><b>Definition</b> fft.hpp:15</div></div>
<div class="ttc" id="aclasspfc_1_1World_html"><div class="ttname"><a href="classpfc_1_1World.html">pfc::World</a></div><div class="ttdoc">Represents a world in the simulation domain.</div><div class="ttdef"><b>Definition</b> world.hpp:27</div></div>
<div class="ttc" id="adecomposition_8hpp_html"><div class="ttname"><a href="decomposition_8hpp.html">decomposition.hpp</a></div></div>
<div class="ttc" id="afft_8hpp_html"><div class="ttname"><a href="fft_8hpp.html">fft.hpp</a></div></div>
<div class="ttc" id="ampi__timers_8cpp_html_a3a49057ffba576f4b5efe09f8a175879"><div class="ttname"><a href="mpi__timers_8cpp.html#a3a49057ffba576f4b5efe09f8a175879">fft</a></div><div class="ttdeci">void fft()</div><div class="ttdef"><b>Definition</b> mpi_timers.cpp:6</div></div>
<div class="ttc" id="anamespacepfc_html"><div class="ttname"><a href="namespacepfc.html">pfc</a></div><div class="ttdef"><b>Definition</b> array.hpp:18</div></div>
<div class="ttc" id="aworld_8hpp_html"><div class="ttname"><a href="world_8hpp.html">world.hpp</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
