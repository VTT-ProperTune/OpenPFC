<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.7" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenPFC: an open source framework for high performance 3D phase field crystal simulations</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
  </script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <style>
    .github-corner svg {
      fill: var(--primary-light-color);
      color: var(--page-background-color);
      width: 72px;
      height: 72px;
    }
    .github-corner:hover .octo-arm {
      animation: octocat-wave 560ms ease-in-out
    }
    @keyframes octocat-wave {
      0%,
      100% {
        transform: rotate(0)
      }
      20%,
      60% {
        transform: rotate(-25deg)
      }
      40%,
      80% {
        transform: rotate(10deg)
      }
    }
    @media (max-width:500px) {
      .github-corner:hover .octo-arm {
        animation: none
      }
      .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }
    }
    @media screen and (max-width: 767px) {
      .github-corner svg {
        width: 50px;
        height: 50px;
      }
      #projectnumber {
        margin-right: 22px;
      }
    }
  </style>
</head>
<body>
  <!-- https://tholman.com/github-corners/ -->
  <a href="https://github.com/VTT-ProperTune/OpenPFC" class="github-corner" title="View source on GitHub"
    target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40"
      style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path
        d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
        fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path
        d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
        fill="currentColor" class="octo-body"></path>
    </svg></a>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="logo.png" /></td>
              <td id="projectalign">
                <div id="projectname">OpenPFC
                  <span id="projectnumber">&#160;0.1.0</span>
                </div>
                <div id="projectbrief">Phase Field Crystal simulation framework</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('08_discrete_fields_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">08_discrete_fields.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Arrays are already quite useful for applying modification to data. Our aim is to do this as easily as possible, because in general, users want to define several different initial conditions and/or boundary conditions for their simulations. By combining the information from World and Decomposition with Array, we can construct "coordinate-aware arrays", which are aware which part of domain decomposition they represent (via the information provided by size of offset from Decomposition), as well as their relative relation to physical coordinate system (origin and discretization from World).</p>
<p>In example 07, it was shown how to use multidimensional arrays to manually "decompose" one bigger array to two smaller ones, manually calculate coordinate system and fill arrays with some data based on physical coordinates. This example reimplements 07 using DiscreteField.</p>
<p>It's possible to add field modifier $$f(x,y,z) = 1 + x + y^2$$ using anonymous function like before, yet more flexible way to work around would be use a class with <code>operator()</code> overloading.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="decomposition_8hpp.html">openpfc/decomposition.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="discrete__field_8hpp.html">openpfc/discrete_field.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="utils_8hpp.html">openpfc/utils.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="world_8hpp.html">openpfc/world.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacepfc.html">pfc</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacepfc_1_1utils.html">pfc::utils</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a id="_a0" name="_a0"></a><a class="code hl_class" href="classModifier.html">Modifier</a> {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">double</span> constant = 1.0;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">double</span> <a id="a1" name="a1"></a><a class="code hl_function" href="classModifier.html#a424084c2e7ea5375e8e11359f37b6c81">operator()</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> z)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> constant + x + y * y + 0.0 * z; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a id="a2" name="a2"></a><a class="code hl_function" href="01__hello__world_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">  <a id="_a3" name="_a3"></a><a class="code hl_class" href="classpfc_1_1World.html">World</a> world({16, 8, 1});</div>
<div class="line">  std::cout &lt;&lt; world &lt;&lt; std::endl;</div>
<div class="line">  <a id="_a4" name="_a4"></a><a class="code hl_class" href="classpfc_1_1Decomposition.html">Decomposition</a> decomp1(world, 0, 4);</div>
<div class="line">  <a class="code hl_class" href="classpfc_1_1Decomposition.html">Decomposition</a> decomp2(world, 1, 4);</div>
<div class="line">  <a class="code hl_class" href="classpfc_1_1Decomposition.html">Decomposition</a> decomp3(world, 2, 4);</div>
<div class="line">  <a class="code hl_class" href="classpfc_1_1Decomposition.html">Decomposition</a> decomp4(world, 3, 4);</div>
<div class="line">  std::cout &lt;&lt; decomp1 &lt;&lt; std::endl;</div>
<div class="line">  <a id="_a5" name="_a5"></a><a class="code hl_class" href="classpfc_1_1DiscreteField.html">DiscreteField&lt;double, 3&gt;</a> field1(decomp1.get_inbox_size(), decomp1.get_inbox_offset(), world.get_origin(),</div>
<div class="line">                                  world.get_discretization());</div>
<div class="line">  <a class="code hl_class" href="classpfc_1_1DiscreteField.html">DiscreteField&lt;double, 3&gt;</a> field2(decomp2.get_inbox_size(), decomp2.get_inbox_offset(), world.get_origin(),</div>
<div class="line">                                  world.get_discretization());</div>
<div class="line">  <a class="code hl_class" href="classpfc_1_1DiscreteField.html">DiscreteField&lt;double, 3&gt;</a> field3(decomp3.get_inbox_size(), decomp3.get_inbox_offset(), world.get_origin(),</div>
<div class="line">                                  world.get_discretization());</div>
<div class="line">  <a class="code hl_class" href="classpfc_1_1DiscreteField.html">DiscreteField&lt;double, 3&gt;</a> field4(decomp4.get_inbox_size(), decomp4.get_inbox_offset(), world.get_origin(),</div>
<div class="line">                                  world.get_discretization());</div>
<div class="line">  std::cout &lt;&lt; field1 &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; field2 &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; field3 &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; field4 &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Define function that is applied to fields. Can can be callable which</span></div>
<div class="line">  <span class="comment">// returns type T and takes std::array&lt;double, D&gt; as input argument.</span></div>
<div class="line">  <span class="comment">// Alternatively, specializations are made for D=2 and D=3, so those also</span></div>
<div class="line">  <span class="comment">// works, taking input arguments `double x, double y` or `double x, double y,</span></div>
<div class="line">  <span class="comment">// double z`.</span></div>
<div class="line">  <a class="code hl_class" href="classModifier.html">Modifier</a> func1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// This would be alternative way ...</span></div>
<div class="line">  <span class="keyword">auto</span> func2 = [](<span class="keyword">const</span> std::array&lt;double, 3&gt; &amp;coords) {</div>
<div class="line">    <span class="keyword">auto</span> [x, y, z] = coords;</div>
<div class="line">    <span class="keywordflow">return</span> 1.0 + x + y * y;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// ... or even this</span></div>
<div class="line">  <span class="keyword">auto</span> func3 = [](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y, <span class="keyword">auto</span> z) { <span class="keywordflow">return</span> 1.0 + x + y * y + 0.0 * z; };</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Here, we apply some function to four different &quot;sub-domains&quot; of a single</span></div>
<div class="line">  <span class="comment">// field. Coordinate transforms and knowledge of offsets and dimensions make</span></div>
<div class="line">  <span class="comment">// sure that function gets applied correctly to each part of the domain.</span></div>
<div class="line">  field1.apply(func1);</div>
<div class="line">  field2.apply(func2);</div>
<div class="line">  field3.apply(func3);</div>
<div class="line">  field4.apply([](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y, <span class="keyword">auto</span> z) { <span class="keywordflow">return</span> 1.0 + x + y * y + 0.0 * z; });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Keep on mind, that in general, one would define only one decomposition and</span></div>
<div class="line">  <span class="comment">// thus one &quot;field&quot; for each MPI process. Thus it&#39;s hard to say, given some</span></div>
<div class="line">  <span class="comment">// spesific coordinate (x, y, z), in which MPI process it stays, and some</span></div>
<div class="line">  <span class="comment">// extra work to find it needs to be done, potentially involving MPI traffic.</span></div>
<div class="line">  <span class="keyword">auto</span> probe = [&amp;](<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) {</div>
<div class="line">    std::array&lt;DiscreteField&lt;double, 3&gt;, 4&gt; fields{field1, field2, field3, field4};</div>
<div class="line">    <span class="keyword">const</span> std::array&lt;double, 3&gt; coords = {x, y, 0.0};</div>
<div class="line">    <span class="keywordtype">int</span> field_num = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;field : fields) {</div>
<div class="line">      <span class="keywordflow">if</span> (field.inbounds(coords)) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Coordinate &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacepfc_1_1utils.html#a7ea8fc2e3dc39736c282909bfcec24fb">array_to_string</a>(coords) &lt;&lt; <span class="stringliteral">&quot; found from sub-domain #&quot;</span> &lt;&lt; field_num &lt;&lt; std::endl;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Value at &quot;</span> &lt;&lt; <a class="code hl_function" href="namespacepfc_1_1utils.html#a7ea8fc2e3dc39736c282909bfcec24fb">array_to_string</a>(coords) &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt; field.interpolate(coords) &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">      field_num++;</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  probe(4.0, 2.0);  <span class="comment">// gives 9, since 1 + 4 + 2 * 2 = 9, found from first sub-domain</span></div>
<div class="line">  probe(12.0, 6.0); <span class="comment">// gives 49, since 1 + 12 + 6 * 6 = 49, found from last sub-domain</span></div>
<div class="line">  std::cout &lt;&lt; func3(4.0, 2.0, 0.0) &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; func3(12.0, 6.0, 0.0) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="a01__hello__world_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="01__hello__world_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> 01_hello_world.cpp:30</div></div>
<div class="ttc" id="aclassModifier_html"><div class="ttname"><a href="classModifier.html">Modifier</a></div><div class="ttdef"><b>Definition</b> 08_discrete_fields.cpp:32</div></div>
<div class="ttc" id="aclassModifier_html_a424084c2e7ea5375e8e11359f37b6c81"><div class="ttname"><a href="classModifier.html#a424084c2e7ea5375e8e11359f37b6c81">Modifier::operator()</a></div><div class="ttdeci">double operator()(double x, double y, double z) const</div><div class="ttdef"><b>Definition</b> 08_discrete_fields.cpp:37</div></div>
<div class="ttc" id="aclasspfc_1_1Decomposition_html"><div class="ttname"><a href="classpfc_1_1Decomposition.html">pfc::Decomposition</a></div><div class="ttdoc">Class representing the domain decomposition for parallel Fast Fourier Transform.</div><div class="ttdef"><b>Definition</b> decomposition.hpp:20</div></div>
<div class="ttc" id="aclasspfc_1_1DiscreteField_html"><div class="ttname"><a href="classpfc_1_1DiscreteField.html">pfc::DiscreteField</a></div><div class="ttdoc">A class representing a discrete field.</div><div class="ttdef"><b>Definition</b> discrete_field.hpp:20</div></div>
<div class="ttc" id="aclasspfc_1_1World_html"><div class="ttname"><a href="classpfc_1_1World.html">pfc::World</a></div><div class="ttdoc">Represents a world in the simulation domain.</div><div class="ttdef"><b>Definition</b> world.hpp:27</div></div>
<div class="ttc" id="adecomposition_8hpp_html"><div class="ttname"><a href="decomposition_8hpp.html">decomposition.hpp</a></div></div>
<div class="ttc" id="adiscrete__field_8hpp_html"><div class="ttname"><a href="discrete__field_8hpp.html">discrete_field.hpp</a></div></div>
<div class="ttc" id="anamespacepfc_1_1utils_html"><div class="ttname"><a href="namespacepfc_1_1utils.html">pfc::utils</a></div><div class="ttdef"><b>Definition</b> utils.hpp:12</div></div>
<div class="ttc" id="anamespacepfc_1_1utils_html_a7ea8fc2e3dc39736c282909bfcec24fb"><div class="ttname"><a href="namespacepfc_1_1utils.html#a7ea8fc2e3dc39736c282909bfcec24fb">pfc::utils::array_to_string</a></div><div class="ttdeci">std::string array_to_string(const std::array&lt; T, D &gt; &amp;arr)</div><div class="ttdef"><b>Definition</b> array_to_string.hpp:12</div></div>
<div class="ttc" id="anamespacepfc_html"><div class="ttname"><a href="namespacepfc.html">pfc</a></div><div class="ttdef"><b>Definition</b> array.hpp:18</div></div>
<div class="ttc" id="autils_8hpp_html"><div class="ttname"><a href="utils_8hpp.html">utils.hpp</a></div></div>
<div class="ttc" id="aworld_8hpp_html"><div class="ttname"><a href="world_8hpp.html">world.hpp</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
